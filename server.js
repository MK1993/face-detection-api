const express=require("express"),cors=require("cors"),bcrypt=require("bcrypt"),handlemain=require("./controllers/handlemain"),handlesignin=require("./controllers/handlesignin"),handleprofile=require("./controllers/handleprofile"),handleimage=require("./controllers/handleimage"),handleregister=require("./controllers/handleregister");auth=require("./controllers/authorization");
const knex=require("knex"),db=knex({client:"pg",connection:{connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}}),app=express();app.use(express.json()),app.use(cors()),app.get("/",(e,p)=>handlemain.main(e,p,db)),app.post("/signin",(e,p)=>handlesignin.signinAuthentication(e,p,bcrypt,db)),app.post("/register",(e,p)=>handleregister.register(e,p,bcrypt,db)),app.get("/profile/:id",auth.requireAuth,(e,p)=>handleprofile.profileGet(e,p,db)),app.post("/profile/:id",auth.requireAuth,(e,p)=>handleprofile.profileUpdate(e,p,db)),app.put("/image",auth.requireAuth,(e,p)=>handleimage.image(e,p,db)),app.post("/imageurl",auth.requireAuth,(e,p)=>handleimage.imageurl(e,p));const port=process.env.PORT||3e3;app.listen(port,()=>{console.log(`Server started at port ${port}`)});